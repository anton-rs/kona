set fallback := true

# default recipe to display help information
default:
  @just --list

# Run the client program natively with the hos
run-client-native l1_rpc l1_beacon_rpc l2_rpc verbosity:
  #!/usr/bin/env bash

  # TODO: These configuration values are currently mocked. Once they're consumed, 
  # update this to offer default run or optionally alter by pre-setting them.
  ROLLUP_CONFIG_PATH="x"
  L2_GENESIS_PATH="x"
  L1_HEAD=$(cast 2b 0)
  L2_HEAD=$(cast 2b 0)
  L2_OUTPUT_ROOT=$(cast 2b 0)
  L2_CLAIM=$(cast 2b 0)
  L2_BLOCK_NUMBER=0

  L1_NODE_ADDRESS="{{l1_rpc}}"
  L1_BEACON_ADDRESS="{{l1_beacon_rpc}}"
  L2_NODE_ADDRESS="{{l2_rpc}}"

  CLIENT_BIN_PATH="./target/release-client-lto/kona-client"

  echo "Building client program..."
  cargo build --bin kona-client --profile release-client-lto
  echo "Running host program with native client program..."
  (cd ../../.. && cargo r --bin kona-host --release -- \
    --rollup-config $ROLLUP_CONFIG_PATH \
    --network optimism \
    --l2-genesis-path $L2_GENESIS_PATH \
    --l1-head $L1_HEAD \
    --l2-head $L2_HEAD \
    --l2-claim $L2_CLAIM \
    --l2-output-root $L2_OUTPUT_ROOT \
    --l2-block-number $L2_BLOCK_NUMBER \
    --l1-node-address $L1_NODE_ADDRESS \
    --l1-beacon-address $L1_BEACON_ADDRESS \
    --l2-node-address $L2_NODE_ADDRESS \
    --exec $CLIENT_BIN_PATH \
    {{verbosity}})
